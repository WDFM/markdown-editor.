"use strict";const{app:n,BrowserWindow:d,Menu:i,shell:f,ipcMain:s}=require("electron"),a=require("path"),{openFileAsString:g,checkFileList:r,getFileList:h,saveFile:b}=require("./handlers"),p=process.platform==="darwin",m="http://localhost:5173",c=()=>{const e=new d({webPreferences:{contextIsolation:!1,nodeIntegration:!0,preload:a.join(__dirname,"preload.js")}});n.isPackaged?e.loadFile(a.join(__dirname,"../index.html")):e.loadURL(m),e.webContents.openDevTools();const u=[...p?[{label:n.name,submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideOthers"},{role:"unhide"},{type:"separator"},{role:"quit"}]}]:[],{role:"fileMenu",label:"文件",submenu:[{label:"打开",role:"open",click:()=>{const o=g();o&&e.webContents.send("open-file-string",o)}}]},{role:"editMenu"},{role:"viewMenu"},{role:"windowMenu"},{role:"help",label:"帮助",submenu:[{label:"Learn More",click:async()=>{await f.openExternal("https://electronjs.org")}}]}];i.setApplicationMenu(i.buildFromTemplate(u)),s.on("check-file-list",(o,t)=>{e.webContents.send("check-file-list",r(t))}),s.on("get-file-list",(o,t=[])=>{const l=r(t);console.log("get-file-list",l),e.webContents.send("get-file-list",h(l)),console.log("get-file-list, done")}),s.on("save-file",async(o,t,l)=>{const w=await b(t,l);e.webContents.send("save-file",w)})};n.whenReady().then(()=>{c(),n.on("activate",()=>{d.getAllWindows().length===0&&c()})});n.on("window-all-closed",()=>{p||n.quit()});

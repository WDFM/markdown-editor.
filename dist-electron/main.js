"use strict";const{app:s,BrowserWindow:u,Menu:r,shell:b,ipcMain:o}=require("electron"),c=require("path"),{openFileAsString:g,checkFileList:d,getFileList:h,saveFile:C,openFileSave:F}=require("./handlers"),t=process.platform==="darwin",v="http://localhost:5173",p=()=>{const e=new u({webPreferences:{devTools:!process.isPackaged,contextIsolation:!1,nodeIntegration:!0,preload:c.join(__dirname,"preload.js")}});s.isPackaged?e.loadFile(c.join(__dirname,"../index.html")):e.loadURL(v),e.webContents.openDevTools();const w=require("./menus/grammerMenu.js")(e),m=[...t?[{label:s.name,submenu:[{role:"about"},{type:"separator"},{role:"services"},{type:"separator"},{role:"hide"},{role:"hideOthers"},{role:"unhide"},{type:"separator"},{role:"quit"}]}]:[],{role:"fileMenu",label:"文件",submenu:[{label:"新建文档",role:"add",id:"addFile",accelerator:t?"Cmd + N":"Ctrl + N",click:()=>{e.webContents.send("add-new-file")}},{label:"打开文档",role:"open",id:"openFile",accelerator:t?"Cmd + Shift + O":"Ctrl + Shift + O",click:()=>{const n=g();n&&e.webContents.send("open-file-string",n)}},{type:"separator"},{label:"关闭",role:"closeFile",id:"closeFile",accelerator:t?"Cmd + W":"Ctrl + W",click:()=>{e.webContents.send("close-file")}},{label:"保存",role:"save",id:"saveFile",accelerator:t?"Cmd + S":"Ctrl + S",click:()=>{console.log(e),e.webContents.send("save-file-menu")}}]},{role:"editMenu",label:"编辑"},{...w},{role:"viewMenu"},{role:"windowMenu"},{role:"help",label:"帮助",submenu:[{label:"Learn More",click:async()=>{await b.openExternal("https://electronjs.org")}}]}],a=r.buildFromTemplate(m);r.setApplicationMenu(a),o.on("check-file-list",(n,l)=>{e.webContents.send("check-file-list",d(l))}),o.on("get-file-list",(n,l=[])=>{const i=d(l);e.webContents.send("get-file-list",h(i)),console.log("get-file-list, done")}),o.on("save-file",async(n,l,i)=>{const f=await C(l,i);e.webContents.send("save-file",f)}),o.on("open-file-menu",()=>{a.getMenuItemById("openFile").click()}),o.on("save-new-file",async(n,l)=>{const i=await F(e,l);e.webContents.send("save-new-file",i)}),o.on("test-fn",(n,l)=>{})};s.whenReady().then(()=>{p(),s.on("activate",()=>{u.getAllWindows().length===0&&p()})});s.on("window-all-closed",()=>{t||s.quit()});
